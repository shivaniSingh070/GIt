define(['jquery','Magento_Ui/js/grid/columns/column','uiLayout','underscore'],function($,Column,layout,_){'use strict';return Column.extend({defaults:{bodyTmpl:'Magento_MediaGalleryUi/grid/columns/image',messageContentSelector:'ul.messages',mediaGalleryContainerSelector:'.media-gallery-container',deleteImageUrl:'media_gallery/image/delete',addSelectedBtnSelector:'#add_selected',deleteSelectedBtnSelector:'#delete_selected',gridSelector:'[data-id="media-gallery-masonry-grid"]',selected:null,allowedActions:[],fields:{id:'id',url:'url',alt:'name'},modules:{actions:'${ $.name }_actions',provider:'${ $.provider }',messages:'${ $.messagesName }',massaction:'${ $.massactionComponentName }'},imports:{activeDirectory:'${ $.mediaGalleryDirectoryComponent }:activeNode'},listens:{activeDirectory:'selectDirectoryHandle','${ $.massactionComponentName }:massActionMode':'updateSelected'},viewConfig:[{component:'Magento_MediaGalleryUi/js/grid/columns/image/actions',name:'${ $.name }_actions',imageModelName:'${ $.name }',allowedActions:'${ $.allowedActions }'}]},initialize:function(){this._super();this.initView();$(window).on('fileDeleted.enhancedMediaGallery',this.reloadMediaGrid.bind(this));$(window).on('reload.MediaGallery',this.reloadGrid.bind(this));return this;},initObservable:function(){this._super().observe(['selected']);return this;},isMassActionMode:function(){return this.massaction().massActionMode();},getUrl:function(record){return record[this.fields.url];},getId:function(record){return record[this.fields.id];},updateSelected:function(){this.selected({});this.hideAddSelectedAndDeleteButon();},getImageAlt:function(record){return record[this.fields.alt];},isSelected:function(record){if(_.isNull(this.selected())){return false;}
if(this.massaction().massActionMode()){return this.selected()[record.id];}
return this.getId(this.selected())===this.getId(record);},clickOnImage:function(record,collapsibleOpened){if(!collapsibleOpened){this.select(record);}},clickOnThreeDots:function(record,collapsibleOpened){if(!this.isSelected(record)||collapsibleOpened){this.select(record);}},checkboxClick:function(record){var items=this.selected();if(this.selected()[record.id]){delete items[record.id];this.selected(items);}else{items[record.id]=record.id;this.selected(items);}
return true;},select:function(record){if(this.massaction().massActionMode()){return this.checkboxClick(record);}
this.isSelected(record)?this.selected(null):this.selected(record);this.toggleAddSelectedButton();return true;},deselectImage:function(){this.selected(null);this.toggleAddSelectedButton();},getSelected:function(){return this.selected();},initView:function(){layout(this.viewConfig);return this;},toggleAddSelectedButton:function(){if(this.selected()===null){this.hideAddSelectedAndDeleteButon();return;}
if(this.allowedActions.includes('insert')){$(this.addSelectedBtnSelector).removeClass('no-display');}
if(this.allowedActions.includes('delete')){$(this.deleteSelectedBtnSelector).removeClass('no-display');}},hideAddSelectedAndDeleteButon:function(){$(this.addSelectedBtnSelector).addClass('no-display');$(this.deleteSelectedBtnSelector).addClass('no-display');},reloadMediaGrid:function(e,data){if(data.reload){this.reloadGrid();}
if(data.message&&data.code){this.addMessage(data.code,data.message);}
this.hideAddSelectedAndDeleteButon();},reloadGrid:function(){var provider=this.provider(),dataStorage=provider.storage();dataStorage.clearRequests();provider.reload();},addMessage:function(code,message){this.messages().add(code,message);this.closeContextMenu();this.scrollToMessageContent();this.messages().scheduleCleanup();},selectDirectoryHandle:function(path){if(this.selected()&&this.selected().directory!==path&&!this.massaction().massActionMode()){this.deselectImage();}},closeContextMenu:function(){$(this.gridSelector).click();},scrollToMessageContent:function(){var scrollTargetElement=$(this.messageContentSelector),scrollTargetContainer=$(this.mediaGalleryContainerSelector);scrollTargetContainer.find(scrollTargetElement).get(0).scrollIntoView({behavior:'smooth',block:'center',inline:'nearest'});}});});
define(["Magento_PageBuilder/js/events","mageUtils","underscore","Magento_PageBuilder/js/config"],function(_events,_mageUtils,_underscore,_config){var Edit=function(){"use strict";function Edit(instance,dataStore){var _this=this;this.instance=instance;this.dataStore=dataStore;_events.on("form:"+this.instance.id+":saveAfter",function(data){var viewport=_config.getConfig("viewport");var defaultViewport=_config.getConfig("defaultViewport");if(defaultViewport!==viewport){_underscore.each(_this.instance.getViewportFields(viewport,data),function(value,key){var isEmpty=!_underscore.find(_mageUtils.compare(data[key],_this.instance.dataStores[defaultViewport].get(key)).changes,function(change){return!_underscore.isEmpty(change.oldValue);});if(isEmpty){_this.instance.dataStores[viewport].set(key,data[key]);data[key]=_this.instance.dataStores[defaultViewport].get(key);}});}
_this.dataStore.setState(_this.filterData(data));});}
var _proto=Edit.prototype;_proto.open=function open(){var _this2=this;var contentTypeData=this.dataStore.getState();var viewport=_config.getConfig("viewport");var defaultViewport=_config.getConfig("defaultViewport");if(defaultViewport!==viewport){_underscore.each(this.instance.getViewportFields(viewport,contentTypeData),function(value,key){if(_mageUtils.compare(contentTypeData[key],_this2.instance.dataStores.desktop.get(key)).equal){contentTypeData[key]=undefined;}});}
_events.trigger("contentType:editBefore",{contentType:this.instance});_events.trigger("form:renderAfter",{data:contentTypeData,appearances:this.instance.config.appearances,defaultNamespace:this.getDefaultNamespaceForm(),id:this.instance.id,namespace:this.getFormNamespace(contentTypeData),title:this.instance.config.label});};_proto.filterData=function filterData(data){return JSON.parse(JSON.stringify(data));};_proto.getFormNamespace=function getFormNamespace(contentTypeData){var viewport=this.instance.preview.viewport();var currentAppearance=this.dataStore.get("appearance");var appearance=this.instance.config.appearances[currentAppearance];var breakpoints=appearance.breakpoints;var formNamespace=this.getDefaultNamespaceForm();if(breakpoints&&breakpoints[viewport]&&breakpoints[viewport].form){formNamespace=breakpoints[viewport].form;}else if(!_underscore.isUndefined(appearance.form)){formNamespace=appearance.form;}
return formNamespace;};_proto.getDefaultNamespaceForm=function getDefaultNamespaceForm(){var viewport=this.instance.preview.viewport();var breakpoints=this.instance.config.breakpoints;var formNamespace=this.instance.config.form;if(breakpoints&&breakpoints[viewport]&&breakpoints[viewport].form){formNamespace=breakpoints[viewport].form;}
return formNamespace;};return Edit;}();return Edit;});
define(['jquery','underscore'],function($,_){'use strict';var ConditionsDataNormalizer=function(){this.patterns={validate:/^[a-z0-9_.-][a-z0-9_.-]*(?:\[(?:\d*|[a-z0-9_.-]+)\])*$/i,key:/[a-z0-9_.-]+|(?=\[\])/gi,push:/^$/,fixed:/^\d+$/,named:/^[a-z0-9_.-]+$/i};};ConditionsDataNormalizer.prototype={normalize:function normalize(value){var el,_this=this;this.pushes={};this.data={};_.each(value,function(e,i){el={};el[i]=e;_this._addPair({name:i,value:e});});return this.data;},_build:function build(base,key,value){base[key]=value;return base;},_makeObject:function makeObject(root,value){var keys=root.match(this.patterns.key),k,idx;while((k=keys.pop())!==undefined){if(this.patterns.push.test(k)){idx=this._incrementPush(root.replace(/\[\]$/,''));value=this._build([],idx,value);}
else if(this.patterns.fixed.test(k)){value=this._build({},k,value);}
else if(this.patterns.named.test(k)){value=this._build({},k,value);}}
return value;},_incrementPush:function incrementPush(key){if(this.pushes[key]===undefined){this.pushes[key]=0;}
return this.pushes[key]++;},_addPair:function addPair(pair){var obj=this._makeObject(pair.name,pair.value);if(!this.patterns.validate.test(pair.name)){return this;}
this.data=$.extend(true,this.data,obj);return this;}};return ConditionsDataNormalizer;});
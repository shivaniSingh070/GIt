define(["jquery","mage/adminhtml/wysiwyg/events","mage/adminhtml/wysiwyg/tiny_mce/setup","Magento_PageBuilder/js/events","underscore","Magento_PageBuilder/js/utils/check-stage-full-screen","Magento_PageBuilder/js/utils/pagebuilder-header-height"],function(_jquery,_events,_setup,_events2,_underscore,_checkStageFullScreen,_pagebuilderHeaderHeight){var Wysiwyg=function(){"use strict";function Wysiwyg(contentTypeId,elementId,config,dataStore,fieldName,stageId){this.saveContentDebounce=_underscore.debounce(this.saveContentFromWysiwygToDataStore.bind(this),500);this.contentTypeId=contentTypeId;this.elementId=elementId;this.fieldName=fieldName;this.config=config;this.dataStore=dataStore;this.stageId=stageId;if(this.config.adapter_config.mode==="inline"){this.config.adapter.tinymce4.content_css=[];}
var wysiwygSetup=new _setup(this.elementId,this.config.adapter);wysiwygSetup.setup(this.config.adapter_config.mode);this.wysiwygAdapter=wysiwygSetup.wysiwygInstance;if(this.config.adapter_config.mode==="inline"){this.wysiwygAdapter.eventBus.attachEventHandler(_events.afterFocus,this.onFocus.bind(this));this.wysiwygAdapter.eventBus.attachEventHandler(_events.afterBlur,this.onBlur.bind(this));}
this.wysiwygAdapter.eventBus.attachEventHandler(_events.afterChangeContent,this.onChangeContent.bind(this));_events2.on("form:"+this.contentTypeId+":saveAfter",this.setContentFromDataStoreToWysiwyg.bind(this));_events2.on("stage:"+this.stageId+":fullScreenModeChangeAfter",this.toggleFullScreen.bind(this));}
var _proto=Wysiwyg.prototype;_proto.toggleFullScreen=function toggleFullScreen(){var _this=this;var $editor=(0,_jquery)("#"+this.elementId);_underscore.defer(function(){if(!(0,_checkStageFullScreen)(_this.stageId)&&_this.config.adapter_config.mode==="inline"&&$editor.hasClass("mce-edit-focus")){$editor.removeClass("mce-edit-focus");_this.onBlur();}});};_proto.getAdapter=function getAdapter(){return this.wysiwygAdapter;};_proto.onFocus=function onFocus(){var _this2=this;this.getFixedToolbarContainer().addClass("pagebuilder-toolbar-active");_events2.trigger("stage:interactionStart");_underscore.defer(function(){_this2.getFixedToolbarContainer().find(".mce-tinymce-inline").css("min-width",_this2.config.adapter_config.minToolbarWidth+"px");_this2.invertInlineEditorToAccommodateOffscreenToolbar();});};_proto.onChangeContent=function onChangeContent(){this.saveContentDebounce();this.invertInlineEditorToAccommodateOffscreenToolbar();};_proto.onBlur=function onBlur(){this.getFixedToolbarContainer().removeClass("pagebuilder-toolbar-active").find(".mce-tinymce-inline").css("transform","");_events2.trigger("stage:interactionStop");};_proto.saveContentFromWysiwygToDataStore=function saveContentFromWysiwygToDataStore(){this.dataStore.set(this.fieldName,this.getAdapter().getContent());};_proto.setContentFromDataStoreToWysiwyg=function setContentFromDataStoreToWysiwyg(){this.getAdapter().setContent(this.dataStore.get(this.fieldName));};_proto.invertInlineEditorToAccommodateOffscreenToolbar=function invertInlineEditorToAccommodateOffscreenToolbar(){if(this.config.adapter_config.mode!=="inline"){return;}
var $inlineToolbar=this.getFixedToolbarContainer().find(".mce-tinymce-inline");if(!$inlineToolbar.length){return;}
var inlineWysiwygClientRectTop=this.getFixedToolbarContainer().get(0).getBoundingClientRect().top-(0,_pagebuilderHeaderHeight)(this.stageId);if(!(0,_checkStageFullScreen)(this.stageId)||$inlineToolbar.height()<inlineWysiwygClientRectTop){$inlineToolbar.css("transform","translateY(-100%)");return;}
$inlineToolbar.css("transform","translateY("+this.getFixedToolbarContainer().height()+"px)");};_proto.getFixedToolbarContainer=function getFixedToolbarContainer(){return(0,_jquery)("#"+this.elementId).closest(""+this.config.adapter.settings.fixed_toolbar_container);};return Wysiwyg;}();return Wysiwyg;});
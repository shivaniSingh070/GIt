define(["Magento_PageBuilder/js/utils/array"],function(_array){var Resize=function(){"use strict";function Resize(columnGroup){this.columnGroup=columnGroup;}
var _proto=Resize.prototype;_proto.getGridSize=function getGridSize(){return parseInt(this.columnGroup.dataStore.get("grid_size").toString(),10);};_proto.getSmallestColumnWidth=function getSmallestColumnWidth(gridSize){gridSize=gridSize||this.getGridSize();return this.getAcceptedColumnWidth(parseFloat((100 / gridSize).toString()).toFixed(Math.round(100 / gridSize)!==100 / gridSize?8:0));};_proto.getAcceptedColumnWidth=function getAcceptedColumnWidth(width,gridSize){gridSize=gridSize||this.getGridSize();var newWidth=0;for(var i=gridSize;i>0;i--){var percentage=parseFloat((100 / gridSize*i).toFixed(Math.round(100 / gridSize*i)!==100 / gridSize*i?8:0));if(parseFloat(width)>percentage-0.1&&parseFloat(width)<percentage+0.1){newWidth=percentage;break;}}
return newWidth;};_proto.getColumnWidth=function getColumnWidth(column){return this.getAcceptedColumnWidth(column.dataStore.get("width").toString());};_proto.getColumnsWidth=function getColumnsWidth(){var _this=this;return this.getAcceptedColumnWidth(this.columnGroup.children().map(function(column){return _this.getColumnWidth(column);}).reduce(function(widthA,widthB){return widthA+(widthB?widthB:0);}).toString());};_proto.determineColumnWidths=function determineColumnWidths(column,groupPosition){var gridSize=this.getGridSize();var singleColumnWidth=groupPosition.outerWidth / gridSize;var adjacentColumn=getAdjacentColumn(column,"+1");var columnWidths=[];var columnLeft=column.preview.element.offset().left-parseInt(column.preview.element.css("margin-left"),10);var adjacentRightPosition=adjacentColumn.preview.element.offset().left+adjacentColumn.preview.element.outerWidth(true);var columnsToRight=column.parentContentType.children().length-(getColumnIndexInGroup(column)+1);var leftMaxWidthFromChildren=groupPosition.left+groupPosition.outerWidth-columnsToRight*singleColumnWidth+10;var rightMaxWidthFromChildren=groupPosition.left+(column.parentContentType.children().length-columnsToRight)*singleColumnWidth-10;for(var i=gridSize;i>0;i--){var position=Math.round(columnLeft+singleColumnWidth*i);if(position>Math.round(leftMaxWidthFromChildren)){continue;}
columnWidths.push({forColumn:"left",name:i+"/"+gridSize,position:position,width:getRoundedColumnWidth(100 / gridSize*i)});}
for(var _i=1;_i<gridSize;_i++){var _position=Math.floor(adjacentRightPosition-_i*singleColumnWidth);if(_position<Math.floor(rightMaxWidthFromChildren)){continue;}
columnWidths.push({forColumn:"right",name:_i+"/"+gridSize,position:_position,width:getRoundedColumnWidth(100 / gridSize*_i)});}
return columnWidths;};_proto.findShrinkableColumnForResize=function findShrinkableColumnForResize(column,direction){var _this2=this;var currentIndex=getColumnIndexInGroup(column);var columnItemsArray=column.parentContentType.children();var searchArray;switch(direction){case"right":searchArray=columnItemsArray.slice(currentIndex+1);break;case"left":searchArray=columnItemsArray.slice(0).reverse().slice(columnItemsArray.length-currentIndex);break;}
return searchArray.find(function(groupColumn){return _this2.getColumnWidth(groupColumn)>_this2.getSmallestColumnWidth();});};_proto.findShrinkableColumn=function findShrinkableColumn(column){var _this3=this;return(0,_array.outwardSearch)(column.parentContentType.children(),getColumnIndexInGroup(column),function(neighbourColumn){return _this3.getColumnWidth(neighbourColumn)>_this3.getSmallestColumnWidth();});};_proto.calculateGhostWidth=function calculateGhostWidth(groupPosition,currentPos,column,modifyColumnInPair,maxGhostWidth){var ghostWidth=currentPos-groupPosition.left;switch(modifyColumnInPair){case"left":var singleColumnWidth=column.preview.element.position().left+groupPosition.outerWidth / this.getGridSize();if(ghostWidth<=singleColumnWidth){ghostWidth=singleColumnWidth;}
if(currentPos>=maxGhostWidth.left){ghostWidth=maxGhostWidth.left-groupPosition.left;}
break;case"right":if(currentPos<=maxGhostWidth.right){ghostWidth=maxGhostWidth.right-groupPosition.left;}
break;}
return ghostWidth;};_proto.determineAdjustedColumn=function determineAdjustedColumn(currentPos,column,history){var modifyColumnInPair="left";var usedHistory;var resizeColumnLeft=column.preview.element.offset().left-parseInt(column.preview.element.css("margin-left"),10);var resizeColumnWidth=column.preview.element.outerWidth(true);var resizeHandlePosition=resizeColumnLeft+resizeColumnWidth;var adjustedColumn;if(currentPos>=resizeHandlePosition){if(history.left.length>0){usedHistory="left";adjustedColumn=history.left.reverse()[0].adjustedColumn;modifyColumnInPair=history.left.reverse()[0].modifyColumnInPair;}else{adjustedColumn=this.findShrinkableColumnForResize(column,"right");}}else{if(this.getColumnWidth(column)<=this.getSmallestColumnWidth()){adjustedColumn=this.findShrinkableColumnForResize(column,"left");if(adjustedColumn){modifyColumnInPair="right";}}else if(history.right.length>0){usedHistory="right";adjustedColumn=history.right.reverse()[0].adjustedColumn;modifyColumnInPair=history.right.reverse()[0].modifyColumnInPair;}else{adjustedColumn=getAdjacentColumn(column,"+1");}}
return[adjustedColumn,modifyColumnInPair,usedHistory];};_proto.resizeColumn=function resizeColumn(column,width,shrinkableColumn){var current=this.getColumnWidth(column);var difference=(parseFloat(width.toString())-current).toFixed(8);if(current===parseFloat(width.toString())||parseFloat(width.toString())<this.getSmallestColumnWidth()){return;}
var allowedToShrink=true;if(difference&&shrinkableColumn){var currentShrinkable=this.getColumnWidth(shrinkableColumn);var shrinkableSize=this.getAcceptedColumnWidth((currentShrinkable+ -difference).toString());if(currentShrinkable===parseFloat(shrinkableSize.toString())||parseFloat(shrinkableSize.toString())<this.getSmallestColumnWidth()){allowedToShrink=false;}else{if(this.gridSupportsResize(column,width,shrinkableColumn,shrinkableSize)){updateColumnWidth(shrinkableColumn,shrinkableSize);}else{allowedToShrink=false;}}}
if(allowedToShrink){updateColumnWidth(column,width);}};_proto.gridSupportsResize=function gridSupportsResize(column,newWidth,shrinkableColumn,shrinkableColumnNewWidth){var _this4=this;var otherColumnsWidth=column.parentContentType.getChildren()().filter(function(gridColumn){return gridColumn!==column&&shrinkableColumn&&gridColumn!==shrinkableColumn;}).map(function(otherColumn){return _this4.getColumnWidth(otherColumn);}).reduce(function(a,b){return a+b;},0);return comparator(otherColumnsWidth+newWidth+(shrinkableColumnNewWidth?shrinkableColumnNewWidth:0),100,0.1);};return Resize;}();function getColumnIndexInGroup(column){return column.parentContentType.children().indexOf(column);}
function getAdjacentColumn(column,direction){var currentIndex=getColumnIndexInGroup(column);if(typeof column.parentContentType.children()[currentIndex+parseInt(direction,10)]!=="undefined"){return column.parentContentType.children()[currentIndex+parseInt(direction,10)];}
return null;}
function determineMaxGhostWidth(columnWidths){var leftColumns=columnWidths.filter(function(width){return width.forColumn==="left";});var rightColumns=columnWidths.filter(function(width){return width.forColumn==="right";});return{left:leftColumns[0].position,right:rightColumns[rightColumns.length-1].position};}
function getRoundedColumnWidth(width){return Number(width.toFixed(Math.round(width)!==width?8:0));}
function comparator(num1,num2,threshold){return num1>num2-threshold / 2&&num1<num2+threshold / 2;}
function updateColumnWidth(column,width){column.dataStore.set("width",parseFloat(width.toString())+"%");}
return Object.assign(Resize,{getColumnIndexInGroup:getColumnIndexInGroup,getAdjacentColumn:getAdjacentColumn,determineMaxGhostWidth:determineMaxGhostWidth,getRoundedColumnWidth:getRoundedColumnWidth,comparator:comparator,updateColumnWidth:updateColumnWidth});});
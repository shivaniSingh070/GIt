define(['underscore','jquery','Magento_PageBuilder/js/events','consoleLogger'],function(_,$,events,consoleLogger){'use strict';var mixin={defaults:{pageBuilderInstances:[]},initialize:function(){var self=this;this._super();events.on('pagebuilder:register',function(data){if(data.ns===self.ns){self.pageBuilderInstances.push(data.instance);}});return this;},save:function(redirect,data){var submit=this._super.bind(this,redirect,data),timeout,locks;if(_.isEmpty(this.pageBuilderInstances)){submit();}else{timeout=setTimeout(function(){consoleLogger.error('Page Builder was rendering for 5 seconds without releasing locks.');},5000);$('body').trigger('processStart');$.when.apply(null,this.pageBuilderInstances.map(function(instance){locks=instance.stage.renderingLocks;return locks[locks.length-1];})).then(function(){$('body').trigger('processStop');clearTimeout(timeout);submit();});}}};return function(target){return target.extend(mixin);};});
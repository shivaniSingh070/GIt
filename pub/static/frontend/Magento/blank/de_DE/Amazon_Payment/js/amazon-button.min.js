define(['jquery','Magento_Customer/js/customer-data','Magento_Customer/js/section-config','Amazon_Payment/js/model/amazonPaymentConfig','amazonCsrf','Magento_Checkout/js/model/full-screen-loader','modernizr/modernizr','amazonCore','uiRegistry','mage/cookies'],function($,customerData,sectionConfig,amazonPaymentConfig,amazonCsrf,fullScreenLoader){'use strict';var _this;if(amazonPaymentConfig.isDefined()){$.widget('amazon.AmazonButton',{options:{merchantId:null,buttonType:'LwA',buttonColor:'Gold',buttonSize:'medium',redirectUrl:null,loginPostUrl:null},_create:function(){_this=this;this._verifyAmazonConfig();if(typeof OffAmazonPayments==='undefined'){$(window).on('OffAmazonPayments',$.proxy(function(){this._renderAmazonButton();},this));}else{this._renderAmazonButton();}},_verifyAmazonConfig:function(){if(amazonPaymentConfig.isDefined()){this.options.merchantId=amazonPaymentConfig.getValue('merchantId');this.options.buttonType=this.options.buttonType==='LwA'?amazonPaymentConfig.getValue('buttonTypeLwa'):amazonPaymentConfig.getValue('buttonTypePwa');this.options.buttonColor=amazonPaymentConfig.getValue('buttonColor');this.options.buttonSize=amazonPaymentConfig.getValue('buttonSize');this.options.redirectUrl=amazonPaymentConfig.getValue('redirectUrl');this.options.loginPostUrl=amazonPaymentConfig.getValue('loginPostUrl');this.options.loginScope=amazonPaymentConfig.getValue('loginScope');this.options.buttonLanguage=amazonPaymentConfig.getValue('displayLanguage');}},secureHttpsCallback:function(event){var sections=sectionConfig.getAffectedSections(_this.options.loginPostUrl);if(!event.state||!amazonCsrf.isValid(event.state)){window.location=amazonPaymentConfig.getValue('customerLoginPageUrl');return window.location;}
if(!event.access_token||!!event.error){window.location=amazonPaymentConfig.getValue('customerLoginPageUrl');return window.location;}
if(sections){customerData.invalidate(sections);}
$.mage.cookies.set('amazon_Login_accessToken',event.access_token);window.location=_this.options.redirectUrl+'?access_token='+event.access_token;},_popupCallback:function(){return _this.usePopUp()?_this.secureHttpsCallback:amazonPaymentConfig.getValue('oAuthHashRedirectUrl');},_touchSupported:function(){return Modernizr.touch!==undefined?Modernizr.touch:Modernizr.touchevents;},usePopUp:function(){return window.location.protocol==='https:'&&!$('body').hasClass('catalog-product-view')&&!this._touchSupported();},_renderAmazonButton:function(){OffAmazonPayments.Button(this.element[0].id,this.options.merchantId,{type:this.options.buttonType,color:this.options.buttonColor,size:this.options.buttonSize,language:this.options.buttonLanguage,authorization:function(){amazon.Login.authorize(_this._getLoginOptions(),_this._popupCallback());}});$('.amazon-button-container .field-tooltip').fadeIn();},_getLoginOptions:function(){return{scope:this.options.loginScope,popup:this.usePopUp(),state:amazonCsrf.generateNewValue()};}});return $.amazon.AmazonButton;}});
define(['Magento_Ui/js/lib/collapsible','underscore'],function(Collapsible,_){'use strict';return Collapsible.extend({defaults:{template:'ui/form/fieldset',collapsible:false,changed:false,loading:false,error:false,opened:false,level:0,visible:true,initializeFieldsetDataByDefault:false,disabled:false,listens:{'opened':'onVisibilityChange'},additionalClasses:{}},initialize:function(){_.bindAll(this,'onChildrenUpdate','onChildrenError','onContentLoading');return this._super()._setClasses();},initConfig:function(){this._super();this._wasOpened=this.opened||!this.collapsible;return this;},initObservable:function(){this._super().observe('changed loading error visible');return this;},initElement:function(elem){elem.initContainer(this);elem.on({'update':this.onChildrenUpdate,'loading':this.onContentLoading,'error':this.onChildrenError});if(this.disabled){try{elem.disabled(true);}
catch(e){}}
return this;},onChildrenUpdate:function(hasChanged){if(!hasChanged){hasChanged=_.some(this.delegate('hasChanged'));}
this.bubble('update',hasChanged);this.changed(hasChanged);},_setClasses:function(){var additional=this.additionalClasses,classes;if(_.isString(additional)){additional=this.additionalClasses.split(' ');classes=this.additionalClasses={};additional.forEach(function(name){classes[name]=true;},this);}
_.extend(this.additionalClasses,{'admin__collapsible-block-wrapper':this.collapsible,_show:this.opened,_hide:!this.opened,_disabled:this.disabled});return this;},onVisibilityChange:function(isOpened){if(!this._wasOpened){this._wasOpened=isOpened;}},onChildrenError:function(message){var hasErrors=false;if(!message){hasErrors=this._isChildrenHasErrors(hasErrors,this);}
this.error(hasErrors||message);if(hasErrors||message){this.open();}},_isChildrenHasErrors:function(hasErrors,container){var self=this;if(hasErrors===false&&container.hasOwnProperty('elems')){hasErrors=container.elems.some('error');if(hasErrors===false&&container.hasOwnProperty('_elems')){container._elems.forEach(function(child){if(hasErrors===false){hasErrors=self._isChildrenHasErrors(hasErrors,child);}});}}
return hasErrors;},onContentLoading:function(isLoading){this.loading(isLoading);}});});
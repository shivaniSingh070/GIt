define(['Magento_Captcha/js/view/checkout/defaultCaptcha','Magento_Captcha/js/model/captchaList','Magento_SalesRule/js/action/set-coupon-code','Magento_SalesRule/js/action/cancel-coupon','Magento_Checkout/js/model/quote','ko'],function(defaultCaptcha,captchaList,setCouponCodeAction,cancelCouponAction,quote,ko){'use strict';var totals=quote.getTotals(),couponCode=ko.observable(null),isApplied;if(totals()){couponCode(totals()['coupon_code']);}
isApplied=ko.observable(couponCode()!=null);return defaultCaptcha.extend({initialize:function(){var self=this,currentCaptcha;this._super();currentCaptcha=captchaList.getCaptchaByFormId(this.formId);if(currentCaptcha!=null){if(!isApplied()){currentCaptcha.setIsVisible(true);}
this.setCurrentCaptcha(currentCaptcha);setCouponCodeAction.registerDataModifier(function(headers){if(self.isRequired()){headers['X-Captcha']=self.captchaValue()();}});setCouponCodeAction.registerFailCallback(function(){if(self.isRequired()){self.refresh();}});setCouponCodeAction.registerSuccessCallback(function(){self.setIsVisible(false);});cancelCouponAction.registerSuccessCallback(function(){if(self.isRequired()){self.setIsVisible(true);}});}}});});
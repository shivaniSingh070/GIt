define(['jquery','Magento_Paypal/js/view/payment/method-renderer/paypal-express-abstract','Magento_Paypal/js/in-context/express-checkout-wrapper','Magento_Paypal/js/action/set-payment-method','Magento_Checkout/js/model/payment/additional-validators','Magento_Ui/js/model/messageList','Magento_Ui/js/lib/view/utils/async'],function($,Component,Wrapper,setPaymentMethod,additionalValidators,messageList){'use strict';return Component.extend(Wrapper).extend({defaults:{template:'Mageplaza_Osc/payment/paypal-express-in-context',validationElements:'input'},initListeners:function(context){$.async(this.validationElements,context,function(element){$(element).on('change',function(){this.validate();}.bind(this));}.bind(this));},validate:function(){this._super();if(this.actions){additionalValidators.validate(true)?this.actions.enable():this.actions.disable();}},beforePayment:function(resolve,reject){var promise=$.Deferred();setPaymentMethod(this.messageContainer).done(function(){return promise.resolve();}).fail(function(response){var error;try{error=JSON.parse(response.responseText);}catch(exception){error=this.paymentActionError;}
this.addError(error);return reject(new Error(error));}.bind(this));return promise;},prepareClientConfig:function(){this._super();this.clientConfig.quoteId=window.checkoutConfig.quoteData['entity_id'];this.clientConfig.customerId=window.customerData.id;this.clientConfig.button=0;return this.clientConfig;},onClick:function(){additionalValidators.validate();this.selectPaymentMethod();},addError:function(message){if($.type(message)==="object"){messageList.addErrorMessage(message);}else{messageList.addErrorMessage({'message':message});}},afterPayment:function(res,resolve,reject){if(res.success){return resolve(res.token);}
this.addError(res['error_message']);return reject(new Error(res['error_message']));},afterOnAuthorize:function(res,resolve,reject,actions){if(res.success){resolve();return actions.redirect(res.redirectUrl);}
this.addError(res['error_message']);return reject(new Error(res['error_message']));}});});
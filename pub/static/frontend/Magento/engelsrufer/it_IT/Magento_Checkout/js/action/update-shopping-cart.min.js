define(['Magento_Ui/js/modal/alert','jquery','jquery-ui-modules/widget','mage/validation'],function(alert,$){'use strict';$.widget('mage.updateShoppingCart',{options:{validationURL:'',eventName:'updateCartItemQty',updateCartActionContainer:''},_create:function(){this._on(this.element,{'submit':this.onSubmit});},onSubmit:function(event){var action=this.element.find(this.options.updateCartActionContainer).val();if(!this.options.validationURL||action==='empty_cart'){return true;}
if(this.isValid()){event.preventDefault();this.validateItems(this.options.validationURL,this.element.serialize());}
return false;},isValid:function(){return this.element.validation()&&this.element.validation('isValid');},validateItems:function(url,data){$.extend(data,{'form_key':$.mage.cookies.get('form_key')});$.ajax({url:url,data:data,type:'post',dataType:'json',context:this,beforeSend:function(){$(document.body).trigger('processStart');},complete:function(){$(document.body).trigger('processStop');}}).done(function(response){if(response.success){this.onSuccess();}else{this.onError(response);}}).fail(function(){this.submitForm();});},onSuccess:function(){$(document).trigger('ajax:'+this.options.eventName);this.submitForm();},onError:function(response){if(response['error_message']){alert({content:response['error_message']});}else{this.submitForm();}},submitForm:function(){this.element.off('submit',this.onSubmit).on('submit',function(){$(document.body).trigger('processStart');}).trigger('submit');}});return $.mage.updateShoppingCart;});